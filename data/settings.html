<!DOCTYPE html>
<html lang="pl-PL">
    <head>
        <title>ESP32</title>
        <meta charset='UTF-8'>
        <script>
        function send(){
          let data = new FormData();

%settings_js%

          for(let i=0; i<6; i++) {
              data.append('input_' + i + '_rballance', document.getElementById('input_' + i + '_rballance').value);
              data.append('input_' + i + '_type', document.getElementById('input_' + i + '_type').value);
              data.append('input_' + i + '_beta', document.getElementById('input_' + i + '_beta').value);
              data.append('input_' + i + '_r25', document.getElementById('input_' + i + '_r25').value);
              data.append('input_' + i + '_rmin', document.getElementById('input_' + i + '_rmin').value);
              data.append('input_' + i + '_rmax', document.getElementById('input_' + i + '_rmax').value);
              data.append('input_' + i + '_max_val', document.getElementById('input_' + i + '_max_val').value);
          }

          for(let i=0; i<%dataDisplayLength%; i++) {
              data.append('data_' + i + '_en', document.getElementById('data_' + i + '_en').checked ? "1" : "0");
              data.append('data_' + i + '_name', document.getElementById('data_' + i + '_name').value);
              data.append('data_' + i + '_unit', document.getElementById('data_' + i + '_unit').value);
              data.append('data_' + i + '_scaleStart', document.getElementById('data_' + i + '_scaleStart').value);
              data.append('data_' + i + '_scaleEnd', document.getElementById('data_' + i + '_scaleEnd').value);

          }

          let xhr = new XMLHttpRequest();
          xhr.open('POST', 'settingsSet');
          xhr.onload = function(){ console.log(this.response); };
          xhr.send(data);
          return false;
        }

        function post(s) {
            let xhr = new XMLHttpRequest();
            xhr.open('POST', s);
            xhr.onload = function(){ console.log(this.response); };
            xhr.send(data);
            return false;
        }

        function preset(i) {
            let preset = parseInt(document.getElementById('input_' + i + '_preset').value);

            switch (preset) {
                case -1:
                    document.getElementById('input_' + i + '_rballance').value = 0;
                    document.getElementById('data_' + i + '_name').value = "";
                    document.getElementById('data_' + i + '_unit').value = "u";
                    document.getElementById('data_' + i + '_scaleStart').value = 0;
                    document.getElementById('data_' + i + '_scaleEnd').value = 0;
                    document.getElementById('input_' + i + '_type').value = 0;
                    document.getElementById('input_' + i + '_beta').value = 0;
                    document.getElementById('input_' + i + '_r25').value = 0;
                    document.getElementById('input_' + i + '_rmin').value = 0;
                    document.getElementById('input_' + i + '_rmax').value = 0;
                    document.getElementById('input_' + i + '_max_val').value = 0;
                    break;
                case 0:
                    document.getElementById('input_' + i + '_rballance').value = 101.5;
                    document.getElementById('data_' + i + '_name').value = "Ciśnienie oleju";
                    document.getElementById('data_' + i + '_unit').value = "bar";
                    document.getElementById('data_' + i + '_scaleStart').value = 0;
                    document.getElementById('data_' + i + '_scaleEnd').value = 12;
                    document.getElementById('input_' + i + '_type').selectedIndex = 0;
                    document.getElementById('input_' + i + '_beta').value = 0;
                    document.getElementById('input_' + i + '_r25').value = 0;
                    document.getElementById('input_' + i + '_rmin').value = 3.0;
                    document.getElementById('input_' + i + '_rmax').value = 160.0;
                    document.getElementById('input_' + i + '_max_val').value = 10.0;
                    break;
                case 1:
                    document.getElementById('input_' + i + '_rballance').value = 10110.0;
                    document.getElementById('data_' + i + '_name').value = "Temperatura oleju";
                    document.getElementById('data_' + i + '_unit').value = "°C";
                    document.getElementById('data_' + i + '_scaleStart').value = 30;
                    document.getElementById('data_' + i + '_scaleEnd').value = 150;
                    document.getElementById('input_' + i + '_type').selectedIndex = 1;
                    document.getElementById('input_' + i + '_beta').value = 3800.0;
                    document.getElementById('input_' + i + '_r25').value = 58000.0;
                    document.getElementById('input_' + i + '_rmin').value = 0;
                    document.getElementById('input_' + i + '_rmax').value = 0;
                    document.getElementById('input_' + i + '_max_val').value = 0;
                    break;
            }
        }

        if (!!window.EventSource) {
            var source = new EventSource('/events');

            source.addEventListener('open', function(e) {
                console.log("Events Connected");
            }, false);

            source.addEventListener('error', function(e) {
                if (e.target.readyState != EventSource.OPEN) {
                    console.log("Events Disconnected");
                }
            }, false);

            source.addEventListener('message', function(e) {
                console.log("message", e.data);
            }, false);

            source.addEventListener('myevent', function(e) {
                console.log("myevent", e.data);
            }, false);

            source.addEventListener('frametime', function(e) {
                document.getElementById("frametime").innerText = "frametime: " + e.data;
            }, false);
        }

        </script>
    </head>
    <body>
        <form onsubmit='return send()'>
            <h1>Ustawienia</h1><p id='frametime'>frametime: </p>
            <button onclick='return reset();window.location.reload(true); '>Przywróć domyślne</button>
            %settings%
            <h2>Wejścia analogowe</h2>
            %input_table%
            <h2>Ustawienia danych</h2>
            %data_list%
            </br><input type='submit'>
        </form>
    </body>
</html>